<!DOCTYPE html>
<html lang="en" ng-app="store">
<head>
	<meta charset="UTF-8">
	<title>Building a store with AngularJS!</title>
	<link rel="stylesheet" type="text/css" href="css/base.css">
</head>
<body ng-controller="StoreController as store">

	<header ng-include="'header.html'"></header>

	<div class="product" ng-repeat="product in store.products | orderBy:'-price'">
		
		<section class="product-info-container">
			<div class="product-image">
				<img ng-src="{{product.image}}">
			</div>
			<product-title></product-title>
		</section>

		<section ng-controller="PanelController as panel">
			<ul>
				<a href ng-click="panel.selectTab(1)">
					<li ng-class="{active:panel.isSelected(1)}">Description</li>
				</a>
				<a href ng-click="panel.selectTab(2)">
					<li ng-class="{active:panel.isSelected(2)}">Specifications</li>
				</a>
				<a href ng-click="panel.selectTab(3)">
					<li ng-class="{active:panel.isSelected(3)}">Reviews</li>
				</a>
			</ul>
			<div class="panel" ng-show="panel.isSelected(1)">
				<h3>Description</h3>
				<p>{{product.description}}</p>
			</div>
			<div class="panel" ng-show="panel.isSelected(2)">
				<h3>Specifications</h3>
				<p>Product Color: {{product.color}}</p>
			</div>
			<div class="panel" ng-show="panel.isSelected(3)">
				<h3>Reviews</h3>
				<blockquote ng-repeat="review in product.reviews">
					<div class="review">
						<b>Stars: {{review.stars}}</b><br>
						<p>{{review.body}}</p><br>
						<cite class="clearfix">by: {{review.author}} {{review.createdOn | date:'MM/dd/yyyy @ h:mma'}}</cite>
					</div>
				</blockquote>
				<div class="review-block" ng-controller="ReviewController as reviewCtrl">
					<blockquote class="review-preview ng-hide">
						<div class="review">
							<b>Stars: {{reviewCtrl.review.stars}}</b><br>
							<p>{{reviewCtrl.review.body}}</p><br>
							<cite>by: {{reviewCtrl.review.author}}</cite>
						</div>
					</blockquote>
					<form class="review-form" name="reviewForm" ng-submit="reviewForm.$valid && reviewCtrl.addReview(product)" novalidate>
						<div>
							Rate this product: 
							<select class="form-select" ng-model="reviewCtrl.review.stars" required>
								<option value="1">1 Star</option>
								<option value="2">2 Stars</option>
								<option value="3">3 Star</option>
								<option value="4">4 Stars</option>
								<option value="5">5 Stars</option>
							</select>
						</div>
						<div>
							<textarea class="form-textarea" ng-model="reviewCtrl.review.body" placeholder="Leave a message..." required></textarea>
						</div>
						<div class="form-author-submit">
							<label>by: </label>
							<input class="form-author" ng-model="reviewCtrl.review.author" placeholder="user@example.com" class="review-author" type="email" required>
							<input class="submit-review" type="submit" value="submit">
							<div>reviewForm is {{reviewForm.$valid}}</div>
						</div>
					</form>
				</div>
			</div>
		</section>

		<button ng-show="product.canPurchase">Add to cart</button>

	</div>

<!-- 	<div class="product" ng-hide="store.products[1].soldOut">
		<div class="product-image">
			<img ng-src="{{store.products[1].image}}">
		</div>
		<h2>{{store.products[1].name}}</h2>
		<h3>{{store.products[1].price | currency}}</h3>
		<h4>{{store.products[1].color}}</h4>
		<p>{{store.products[1].description}}</p>
		<button ng-show="store.products[1].canPurchase">Add to cart</button>
	</div> -->

	<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
	<script type="text/javascript" src="bower_components/angular/angular.min.js"></script>
	<script type="text/javascript" src="js/app.js"></script>
</body>

<script type="text/javascript">
    $(document).ready(function() {
		$('.form-select').on('click', function() {
			$(this).parents('.review-block').children('.review-preview').removeClass('ng-hide');
		});

		$('.form-textarea').on('click', function() {
			$(this).parents('.review-block').children('.review-preview').removeClass('ng-hide');
		});

		$('.form-author').on('click', function() {
			$(this).parents('.review-block').children('.review-preview').removeClass('ng-hide');
		});

		$('.submit-review').on('click', function() {
			$(this).parents('.review-block').children('.review-preview').addClass('ng-hide');
		});

		$('form').on('focusout', function() {
			$(this).parents('.review-block').children('.review-preview').addClass('ng-hide');
		});

	});
</script>

</html>